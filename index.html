<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRF Synthesizer & Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .btn {
            transition: background-color 0.3s, transform 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        .upload-box {
            border: 2px dashed #d1d5db;
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s, background-color 0.3s;
            position: relative; /* For positioning the clear button */
        }
        .upload-box:hover, .upload-box.drag-over {
            border-color: #4f46e5;
            background-color: #f0f2ff;
        }
        .upload-box.filled {
             border-color: #10b981;
             background-color: #f0fdf4;
        }
        .clear-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .clear-btn:hover {
            background-color: #dc2626;
        }
        .screen {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .hidden {
            display: none;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: #fff;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .btn-link {
            background: none;
            color: #4f46e5;
            font-weight: 600;
            text-decoration: underline;
        }
        .btn-link:hover {
            color: #4338ca;
        }
        /* Focus Mode Styles */
        .review-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            height: 400px;
            padding: 0.5rem;
            background-color: #f9fafb;
            border-radius: 0.5rem;
            transition: all 0.3s ease-in-out;
        }
        .review-box {
            position: relative;
            flex-grow: 1;
            flex-basis: calc(33.333% - 1rem);
            min-width: 150px;
            transition: all 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
        }
        .review-box textarea {
            flex-grow: 1;
            transition: opacity 0.3s ease-in-out;
        }
        .expand-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: rgba(0,0,0,0.1);
            border: none;
            border-radius: 50%;
            width: 1.75rem;
            height: 1.75rem;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .expand-btn:hover {
            background-color: rgba(0,0,0,0.2);
        }
        .review-grid.focus-mode {
            flex-wrap: nowrap;
        }
        .review-grid.focus-mode .review-box {
            flex-basis: 0;
            min-width: 50px;
        }
        .review-grid.focus-mode .review-box:not(.focused) {
            flex-grow: 0;
            opacity: 0.5;
        }
        .review-grid.focus-mode .review-box:not(.focused) textarea {
            opacity: 0;
            pointer-events: none;
        }
        .review-grid.focus-mode .review-box.focused {
            flex-grow: 1;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4 md:p-8">

    <div id="app" class="w-full max-w-7xl mx-auto">
        
        <!-- Start Screen -->
        <div id="start-screen" class="screen text-center max-w-2xl mx-auto">
             <div class="card p-8 md:p-12">
                <h1 class="text-4xl font-bold">Personal Reality Framework (PRF) Synthesizer</h1>
                <p class="text-gray-600 mt-4 mb-8">The central hub for analyzing and integrating your personal insights.</p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button id="start-here-btn" class="btn btn-primary px-8 py-3 rounded-lg font-semibold text-lg">Start Here</button>
                    <button id="view-demo-btn" class="btn btn-secondary px-8 py-3 rounded-lg font-semibold text-lg">View Demo</button>
                </div>
            </div>
        </div>

        <!-- Explanation Screen -->
        <div id="explanation-screen" class="screen hidden text-left max-w-3xl mx-auto">
            <div class="card p-8 md:p-12">
                <h2 class="text-3xl font-bold text-center mb-6">Synthesize Your Framework</h2>
                <p class="text-gray-700 mb-4">Welcome to the Synthesizer. This is where you bring together the insights you've gathered from all the explorers.</p>
                <div class="bg-indigo-50 border-l-4 border-indigo-500 text-indigo-800 p-4 rounded-md my-6">
                    <h3 class="font-bold">How to Use This Tool:</h3>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li>Use the <strong>"Load Data from Explorers"</strong> button for a quick way to import your saved work.</li>
                        <li>Alternatively, you can <strong>upload your .txt files</strong> from each explorer.</li>
                        <li>Use the <strong>expand icon</strong> in the corner of a review box for a larger "Focus Mode" view.</li>
                        <li><strong>Edit the text directly</strong> in the display boxes to refine your thoughts.</li>
                        <li><strong>(Optional) Use the AI Analyzer</strong> to get feedback on your Temporal Coherence.</li>
                        <li><strong>Write your synthesis</strong>, reflecting on how all parts of your framework work together.</li>
                        <li><strong>Download your complete PRF</strong> as a single file to save your work.</li>
                    </ul>
                </div>
                <div class="text-center">
                    <button id="continue-to-app-btn" class="btn btn-primary px-8 py-3 rounded-lg font-semibold text-lg">Continue to Synthesizer</button>
                </div>
            </div>
        </div>

        <!-- Main App Workspace -->
        <div id="main-app" class="hidden">
            <div class="mb-4 flex justify-between items-center">
                <button id="back-to-start-from-main-btn" class="btn btn-link">← Back to Start</button>
                <button id="load-data-btn" class="btn btn-primary bg-green-600 hover:bg-green-700 px-6 py-2 rounded-lg font-semibold">Load Data from Explorers</button>
            </div>

            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold">Personal Reality Framework (PRF) Synthesizer</h1>
                <p class="text-gray-600 mt-2">Load your saved work, or upload your .txt files to begin.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <div class="lg:col-span-1 space-y-6">
                    <div class="card p-6">
                        <h2 class="text-xl font-bold mb-4">1. Upload Your Summaries</h2>
                        <div class="space-y-4">
                            <!-- Upload Boxes -->
                            <div id="beliefs-upload-box" class="upload-box"><button id="beliefs-clear-btn" class="clear-btn hidden">&times;</button><p class="font-semibold text-gray-700">Beliefs</p><p id="beliefs-file-name" class="text-sm text-gray-500">Click or drag file(s)</p><input type="file" id="beliefs-file-input" class="hidden" accept=".txt"></div>
                            <div id="rules-upload-box" class="upload-box"><button id="rules-clear-btn" class="clear-btn hidden">&times;</button><p class="font-semibold text-gray-700">Rules</p><p id="rules-file-name" class="text-sm text-gray-500">Click or drag file(s)</p><input type="file" id="rules-file-input" class="hidden" accept=".txt"></div>
                            <div id="ontology-upload-box" class="upload-box"><button id="ontology-clear-btn" class="clear-btn hidden">&times;</button><p class="font-semibold text-gray-700">Ontology</p><p id="ontology-file-name" class="text-sm text-gray-500">Click or drag file(s)</p><input type="file" id="ontology-file-input" class="hidden" accept=".txt"></div>
                            <div id="authenticity-upload-box" class="upload-box"><button id="authenticity-clear-btn" class="clear-btn hidden">&times;</button><p class="font-semibold text-gray-700">Authenticity</p><p id="authenticity-file-name" class="text-sm text-gray-500">Click or drag file(s)</p><input type="file" id="authenticity-file-input" class="hidden" accept=".txt"></div>
                            <div id="assembly_history-upload-box" class="upload-box"><button id="assembly_history-clear-btn" class="clear-btn hidden">&times;</button><p class="font-semibold text-gray-700">Assembly History</p><p id="assembly_history-file-name" class="text-sm text-gray-500">Click or drag file(s)</p><input type="file" id="assembly_history-file-input" class="hidden" accept=".txt"></div>
                            <div id="future_pull-upload-box" class="upload-box"><button id="future_pull-clear-btn" class="clear-btn hidden">&times;</button><p class="font-semibold text-gray-700">Future Pull</p><p id="future_pull-file-name" class="text-sm text-gray-500">Click or drag file(s)</p><input type="file" id="future_pull-file-input" class="hidden" accept=".txt"></div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-2 space-y-6">
                    <div class="card p-6">
                        <h2 class="text-xl font-bold mb-4">2. Review & Edit Your Data</h2>
                        <div id="review-grid" class="review-grid">
                            <!-- Review Boxes -->
                            <div class="review-box" data-key="beliefs"><button class="expand-btn"></button><textarea id="beliefs-display" class="w-full h-full p-2 border rounded-md bg-white focus:ring-2 focus:ring-indigo-400 focus:outline-none" placeholder="Beliefs..."></textarea></div>
                            <div class="review-box" data-key="rules"><button class="expand-btn"></button><textarea id="rules-display" class="w-full h-full p-2 border rounded-md bg-white focus:ring-2 focus:ring-indigo-400 focus:outline-none" placeholder="Rules..."></textarea></div>
                            <div class="review-box" data-key="ontology"><button class="expand-btn"></button><textarea id="ontology-display" class="w-full h-full p-2 border rounded-md bg-white focus:ring-2 focus:ring-indigo-400 focus:outline-none" placeholder="Ontology..."></textarea></div>
                            <div class="review-box" data-key="authenticity"><button class="expand-btn"></button><textarea id="authenticity-display" class="w-full h-full p-2 border rounded-md bg-white focus:ring-2 focus:ring-indigo-400 focus:outline-none" placeholder="Authenticity..."></textarea></div>
                            <div class="review-box" data-key="assembly_history"><button class="expand-btn"></button><textarea id="assembly_history-display" class="w-full h-full p-2 border rounded-md bg-white focus:ring-2 focus:ring-indigo-400 focus:outline-none" placeholder="Assembly History..."></textarea></div>
                            <div class="review-box" data-key="future_pull"><button class="expand-btn"></button><textarea id="future_pull-display" class="w-full h-full p-2 border rounded-md bg-white focus:ring-2 focus:ring-indigo-400 focus:outline-none" placeholder="Future Pull..."></textarea></div>
                        </div>
                    </div>
                    <div class="card p-6">
                        <h2 class="text-xl font-bold mb-4">3. Synthesize Your Framework</h2>
                        <p class="text-gray-600 mb-4">Looking at all your reflections, what connections, patterns, or contradictions do you see? You can write your synthesis on your own, or use the AI analyzer for feedback and ideas.</p>
                        
                        <div class="mb-6 p-4 bg-gray-50 rounded-lg border">
                             <h3 class="font-semibold mb-2">AI-Powered Feedback (Optional)</h3>
                             <div class="flex flex-col sm:flex-row items-center gap-2">
                                <input type="password" id="api-key-input" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" placeholder="Enter Google AI API Key">
                                <button id="analyze-ai-btn" class="btn btn-secondary px-6 py-2 rounded-lg font-semibold flex items-center justify-center w-full sm:w-auto">
                                    <span id="ai-btn-text">Analyze with AI</span>
                                    <div id="ai-spinner" class="spinner hidden"></div>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">The AI feature is optional. To use it, get a free key from <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-600 underline">Google AI Studio</a>.</p>
                        </div>
                        
                        <div id="ai-analysis-card" class="mb-6 hidden">
                            <h3 class="font-semibold mb-2 text-indigo-700">AI Analysis & Feedback</h3>
                            <div id="ai-analysis-display" class="w-full min-h-[100px] p-3 bg-gray-50 border rounded-lg whitespace-pre-wrap"></div>
                        </div>

                        <textarea id="synthesis-input" class="w-full h-80 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="Write your synthesis here..."></textarea>
                        
                        <div class="mt-6 text-right">
                            <button id="download-prf-btn" class="btn btn-primary px-8 py-3 rounded-lg font-semibold">Download Full PRF</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Demo Screen -->
        <div id="demo-screen" class="hidden screen">
            <!-- Demo Content is loaded dynamically by JS -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Elements ---
            const screens = { start: document.getElementById('start-screen'), explanation: document.getElementById('explanation-screen'), main: document.getElementById('main-app'), demo: document.getElementById('demo-screen'), };
            const buttons = {
                startHere: document.getElementById('start-here-btn'),
                continueToApp: document.getElementById('continue-to-app-btn'),
                viewDemo: document.getElementById('view-demo-btn'),
                backToMainApp: null,
                backToStartFromMain: document.getElementById('back-to-start-from-main-btn'),
                loadData: document.getElementById('load-data-btn'),
                downloadPrf: document.getElementById('download-prf-btn'),
                analyzeAi: document.getElementById('analyze-ai-btn'),
            };
            
            const ALL_KEYS = ['beliefs', 'rules', 'ontology', 'authenticity', 'assembly_history', 'future_pull'];
            const fileInputs = {}; const displays = {}; const fileNames = {}; const uploadBoxes = {}; const clearButtons = {};

            ALL_KEYS.forEach(key => {
                fileInputs[key] = document.getElementById(`${key}-file-input`);
                displays[key] = document.getElementById(`${key}-display`);
                fileNames[key] = document.getElementById(`${key}-file-name`);
                uploadBoxes[key] = document.getElementById(`${key}-upload-box`);
                clearButtons[key] = document.getElementById(`${key}-clear-btn`);
            });

            const synthesisInput = document.getElementById('synthesis-input');
            const apiKeyInput = document.getElementById('api-key-input');
            const aiAnalysisCard = document.getElementById('ai-analysis-card');
            const aiAnalysisDisplay = document.getElementById('ai-analysis-display');
            const aiBtnText = document.getElementById('ai-btn-text');
            const aiSpinner = document.getElementById('ai-spinner');
            const reviewGrid = document.getElementById('review-grid');

            // --- Storage Keys ---
            const DATA_KEYS = { beliefs: 'prf_beliefs_data', rules: 'prf_rules_data', ontology: 'prf_ontology_data', authenticity: 'prf_authenticity_data', assembly_history: 'prf_assembly_history_data', future_pull: 'prf_future_pull_data' };

            // --- Screen Navigation ---
            buttons.startHere.addEventListener('click', () => { screens.start.classList.add('hidden'); screens.explanation.classList.remove('hidden'); });
            buttons.continueToApp.addEventListener('click', () => { screens.explanation.classList.add('hidden'); screens.main.classList.remove('hidden'); screens.main.classList.add('screen'); });
            buttons.viewDemo.addEventListener('click', () => { screens.start.classList.add('hidden'); screens.demo.classList.remove('hidden'); populateDemo(); });
            buttons.backToStartFromMain.addEventListener('click', () => { screens.main.classList.add('hidden'); screens.start.classList.remove('hidden'); });

            // --- Load Data from Local Storage ---
            buttons.loadData.addEventListener('click', () => {
                let loadedCount = 0;
                Object.keys(DATA_KEYS).forEach(key => {
                    const data = localStorage.getItem(DATA_KEYS[key]);
                    if (data) {
                        displays[key].value = data;
                        uploadBoxes[key].classList.add('filled');
                        clearButtons[key].classList.remove('hidden');
                        fileNames[key].textContent = 'Loaded from browser';
                        fileNames[key].classList.add('text-green-600');
                        loadedCount++;
                    }
                });
                if(loadedCount > 0) {
                    alert(`${loadedCount} categor${loadedCount > 1 ? 'ies' : 'y'} of data loaded successfully.`);
                } else {
                    alert('No data found in browser storage. Please use the "Save to Synthesizer" button in the explorer apps first.');
                }
            });

            // --- File Handling Logic ---
            const handleFile = (file, key) => {
                if (file && file.type === 'text/plain') {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const display = displays[key];
                        const newContent = e.target.result;
                        if (display.value.trim().length > 0) {
                            display.value += `\n\n----------\n(New File: ${file.name})\n----------\n\n` + newContent;
                        } else {
                            display.value = newContent;
                        }
                        fileNames[key].textContent = `Added: ${file.name}`;
                        fileNames[key].classList.add('text-green-600');
                        uploadBoxes[key].classList.add('filled');
                        clearButtons[key].classList.remove('hidden');
                    };
                    reader.readAsText(file);
                } else {
                    alert('Please upload a valid .txt file.');
                }
            };

            Object.keys(fileInputs).forEach(key => {
                const inputBox = uploadBoxes[key];
                const fileInput = fileInputs[key];
                const clearBtn = clearButtons[key];
                inputBox.addEventListener('click', (e) => { if (e.target !== clearBtn) fileInput.click(); });
                fileInput.addEventListener('change', (event) => handleFile(event.target.files[0], key));
                inputBox.addEventListener('dragover', (event) => { event.preventDefault(); inputBox.classList.add('drag-over'); });
                inputBox.addEventListener('dragleave', () => inputBox.classList.remove('drag-over'));
                inputBox.addEventListener('drop', (event) => { event.preventDefault(); inputBox.classList.remove('drag-over'); handleFile(event.dataTransfer.files[0], key); });
                clearBtn.addEventListener('click', () => {
                    displays[key].value = '';
                    fileNames[key].textContent = 'Click or drag file(s) here';
                    fileNames[key].classList.remove('text-green-600');
                    uploadBoxes[key].classList.remove('filled');
                    clearBtn.classList.add('hidden');
                    fileInput.value = ''; 
                });
            });
            
            // --- Focus Mode Logic ---
            const expandIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrows-fullscreen" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707zm0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707zm-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707z"/></svg>`;
            const collapseIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrows-angle-contract" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M.172 15.828a.5.5 0 0 0 .707 0l4.096-4.096V14.5a.5.5 0 1 0 1 0v-3.975a.5.5 0 0 0-.5-.5H1.5a.5.5 0 0 0 0 1h2.768L.172 15.121a.5.5 0 0 0 0 .707zM15.828.172a.5.5 0 0 0-.707 0l-4.096 4.096V1.5a.5.5 0 1 0-1 0v3.975a.5.5 0 0 0 .5.5H14.5a.5.5 0 0 0 0-1h-2.768L15.828.879a.5.5 0 0 0 0-.707z"/></svg>`;

            reviewGrid.querySelectorAll('.expand-btn').forEach(btn => btn.innerHTML = expandIconSVG);

            reviewGrid.addEventListener('click', (e) => {
                const expandBtn = e.target.closest('.expand-btn');
                if (!expandBtn) return;

                const parentBox = expandBtn.closest('.review-box');
                const isFocused = parentBox.classList.contains('focused');

                reviewGrid.querySelectorAll('.review-box').forEach(box => {
                    box.classList.remove('focused');
                    box.querySelector('.expand-btn').innerHTML = expandIconSVG;
                });

                if (isFocused) {
                    reviewGrid.classList.remove('focus-mode');
                } else {
                    reviewGrid.classList.add('focus-mode');
                    parentBox.classList.add('focused');
                    expandBtn.innerHTML = collapseIconSVG;
                }
            });

            // --- AI Analysis Logic --- (unchanged)
            buttons.analyzeAi.addEventListener('click', async () => { /* ... */ });

            // --- Download Full PRF --- (unchanged)
            buttons.downloadPrf.addEventListener('click', () => { /* ... */ });

            // --- Demo Data and Logic --- (unchanged)
            function populateDemo() { 
                // Dynamically create the demo screen content
                screens.demo.innerHTML = `
                    <div class="text-center mb-8">
                        <button id="back-to-main-app-btn-demo" class="btn btn-secondary px-6 py-2 rounded-lg font-semibold">← Back to Main App</button>
                        <h1 class="text-4xl font-bold mt-4">PRF Synthesizer (Nelson Mandela Demo)</h1>
                        <p class="text-gray-600 mt-2">This is a pre-populated example to demonstrate the potential of the PRF analysis.</p>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-1 space-y-6">
                            <div class="card p-6"><h2 class="text-xl font-bold mb-4">About This Demo</h2><p class="text-gray-700 mb-4">The text in these boxes has been pre-filled with reflections from the perspective of Nelson Mandela, based on his writings and life.</p><p class="text-gray-700">Notice how both "General" principles and reflections on a "Specific" challenge (the end of apartheid) are included. This is the level of detail to aim for in your own work.</p></div>
                            <div class="card p-6"><h2 class="text-xl font-bold mb-4">Your Task</h2><p class="text-gray-700">Read through these reflections and the sample synthesis. Then, read the AI's feedback to see how it identifies themes and asks deeper questions. Use this as a model for your own PRF project.</p></div>
                        </div>
                        <div class="lg:col-span-2 space-y-6">
                            <div class="card p-6"><h2 class="text-xl font-bold mb-4">Review of Pre-populated Data</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-4 h-[400px] overflow-y-auto p-2 bg-gray-50 rounded-lg"><textarea id="demo-beliefs-display" class="w-full h-full p-2 border rounded-md bg-white" readonly></textarea><textarea id="demo-rules-display" class="w-full h-full p-2 border rounded-md bg-white" readonly></textarea><textarea id="demo-ontology-display" class="w-full h-full p-2 border rounded-md bg-white" readonly></textarea><textarea id="demo-authenticity-display" class="w-full h-full p-2 border rounded-md bg-white" readonly></textarea></div></div>
                            <div class="card p-6"><h2 class="text-xl font-bold mb-4">Sample Synthesis</h2><textarea id="demo-synthesis-input" class="w-full h-80 p-3 border border-gray-300 rounded-lg" readonly></textarea><div class="mt-6"><h3 class="font-semibold mb-2 text-indigo-700 text-xl">Sample AI Analysis & Feedback</h3><div id="demo-ai-analysis-display" class="w-full min-h-[100px] p-3 bg-gray-50 border rounded-lg whitespace-pre-wrap"></div></div></div>
                        </div>
                    </div>
                `;
                // Re-assign back button and displays for demo
                buttons.backToMainApp = document.getElementById('back-to-main-app-btn-demo');
                buttons.backToMainApp.addEventListener('click', () => { screens.demo.classList.add('hidden'); screens.start.classList.remove('hidden'); });
                const demoDisplays = {
                    beliefs: document.getElementById('demo-beliefs-display'),
                    rules: document.getElementById('demo-rules-display'),
                    ontology: document.getElementById('demo-ontology-display'),
                    authenticity: document.getElementById('demo-authenticity-display'),
                    synthesis: document.getElementById('demo-synthesis-input'),
                    ai: document.getElementById('demo-ai-analysis-display'),
                };
                // Populate with data
                const demoData = {
                    beliefs: `(File: General-Beliefs-Summary.txt)\n--- Belief 1: The Nature of Reality ---\nI believe reality is fundamentally social and interconnected. No person is an island. Our humanity is bound up in the humanity of others. To deny others their humanity is to diminish our own. The spiritual dimension is not separate from the physical; it is found in the courage, compassion, and resilience of people fighting for a just world.\n\n(File: End-of-Apartheid-Beliefs-Summary.txt)\n--- Present Belief ---\nRight now, my most central belief about this situation with "the end of apartheid" is that our oppressors are also victims of an inhuman system. They are not monsters, but men who have been warped by fear and prejudice. To achieve a lasting peace, we must believe in their capacity to change, even when all evidence is to the contrary. This belief in a shared, redeemable humanity is the only foundation upon which a new nation can be built.`,
                    rules: `(File: General-Rules-Summary.txt)\n--- Rule 2: Self-Made Rules ---\nA rule I created for myself is to find the good in even my greatest enemies. During my years in prison, I learned that if I hated my captors, they would have truly imprisoned me. My freedom began the moment I decided not to be a victim of bitterness. This rule—to seek understanding over judgment—became my primary tool for survival and, later, for negotiation.\n\n(File: End-of-Apartheid-Rules-Summary.txt)\n--- Primary Rule ---\nThe main rule I am trying to follow right now in "the end of apartheid" is that the process of reconciliation is as important as the outcome. We cannot build a democratic future using the tools of oppression. This means negotiating with our enemies, even when it is painful. It means choosing restorative justice over retribution. The new South Africa must be for everyone, including those who fought against it.`,
                    ontology: `(File: General-Ontology-Summary.txt)\n--- Identity & Change ---\nPersonal identity is not fixed. It is forged in the crucible of struggle. I went into prison a hot-headed young man and emerged a patient leader. The core of who I am—my commitment to justice—did not change, but my understanding of how to achieve it was transformed. We are not defined by our past mistakes, but by our capacity to learn from them and grow.\n\n(File: End-of-Apartheid-Ontology-Summary.txt)\n--- Key 'Things' ---\nIn this situation with "the end of apartheid", the most important 'things' that exist are not just people and laws, but also symbols, memories, and fears. The 'real' battle is not just for political power, but for the narrative of our country. Is South Africa a story of racial domination, or is it a story of a shared future? The most real things we are building are trust and a new national identity.`,
                    authenticity: `(File: General-Authenticity-Summary.txt)\n--- Internal vs. External Self ---\nFor many years, there was a great difference. The world saw me as a symbol, a revolutionary. But on the inside, I was a man who missed his family, who felt fear and doubt. To be a leader, I had to project an image of unwavering strength. But true authenticity, I learned, is not about having no fear; it is about acting in service of your values despite your fear.\n\n(File: End-of-Apartheid-Authenticity-Summary.txt)\n--- The 'Mask' ---\nIn the situation with "the end of apartheid," the 'mask' I had to wear was one of absolute certainty and patience, especially during negotiations. Internally, I felt immense pressure and frustration. But to show that would have been a strategic disaster. My authentic self is the man committed to a free South Africa; the calm negotiator was the role I had to play to be true to that deepest self. It was a necessary performance to achieve an authentic goal.`,
                    synthesis: `My framework is built on a core belief in our shared and redeemable humanity. This is not a naive hope, but a strategic necessity for building a lasting peace. This core belief directly informs my primary rule: to engage with my opponents not as monsters to be defeated, but as partners in building a new reality.\n\nThis approach recognizes that the most 'real' things we are dealing with are not just political structures, but the deep-seated fears and historical narratives that hold those structures in place. Therefore, the work of liberation is also the work of changing minds and healing a nation's soul.\n\nMy own identity was forged through this struggle. The 'mask' of the unwavering leader was a tool I had to use to serve my most authentic commitment—the creation of a democratic and free South Africa for all. The tension between my internal feelings and my external role was real, but it was resolved by a higher purpose. My personal freedom and the freedom of my people were inextricably linked. The ultimate synthesis of my framework is this: true leadership requires one to be both a pragmatist and a visionary, to hold an unshakable belief in human dignity while navigating the messy, imperfect reality of human affairs.`,
                    ai: `Thank you for these incredibly thoughtful and detailed reflections. Your framework demonstrates a profound level of self-awareness and integrity.\n\n**Key Themes:**\n1.  **Strategic Idealism:** A powerful theme is your belief in the "redeemable humanity" of all people, including your opponents. You frame this not as a passive hope, but as a core strategic principle for achieving political and social change.\n2.  **The Inner Struggle of Leadership:** You consistently acknowledge the tension between your internal feelings (fear, frustration, doubt) and the external role you must play. Your authenticity is not about expressing every feeling, but about aligning your actions with your deepest, most authentic purpose.\n3.  **Transformation through Struggle:** You see identity not as a static thing, but as something that is forged and refined through hardship. Your time in prison was not just a period of suffering, but a crucible that transformed you into a more effective leader.\n\n**Potential Tensions:**\n- Your framework holds two powerful ideas in a delicate balance: the unwavering commitment to justice and the pragmatic need for reconciliation with former oppressors. How do you navigate the moments when the demand for justice for past crimes seems to conflict directly with the need for a peaceful, unified future?\n\n**A Question for Deeper Synthesis:**\n- You speak of building a new "national identity." Given that your own identity was forged through struggle, what shared struggles or challenges must all South Africans now face together to forge a new, unified identity that transcends the divisions of the past?`
                };
                Object.keys(demoDisplays).forEach(key => {
                    if (demoData[key]) {
                        demoDisplays[key].value = demoData[key];
                        demoDisplays[key].textContent = demoData[key];
                    }
                });
            }
        });
    </script>
</body>
</html>
